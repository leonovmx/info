# Задача 9
ЛМ  
28 февраля 2015 г.  
----------------------
*[Главная](http://leonovmx.github.io/info/index.html) --- [Семестр 2](./index/html)*
*Обновлено: 29 апреля 2015*
----------------------

Документ будет формироваться и немного меняться.

# Задачи
1. Кластеризация банков на последнюю дату
2. Динамика доли кредитов и депозитов госбанков
3. Динамика доли банков, которая предоставила отчётность
4. Список банков, которые меняли названия
# Данные

При выполнении задания рекомендую установить рабочую директорию.
В данной папке у вас должны находится скаченные документы и фалы. Это существенно упростит выполнение задания.

```r
    setwd("~/Яндекс.Диск/banks")
# ~  обозначает "домашнюю" папку
# Можно писатьи "C:/Информатика/папка/"
```
# Описание
Данные представляют собой балансы банков с 2004 года на каждый месяц по н/в. 

[Сайт ЦБ РФ](http://cbr.ru/) --- [Информация по кредитным организациям](http://cbr.ru/credit/) --- [Формы отчётности](http://cbr.ru/credit/forms.asp)

Форма 101 --- Оборотная ведомость по счетам бухгалтерского учета кредитной 
организации (А, к примеру, форма 102 --- отчёт о прибылях и убытках). 
Данная форма составляется на конкретную дату (на первое число каждого месяца 
без учета операций в этот день). Форма содержит информацию о привлечённых 
депозитах, выданных кредитах, объёмах просроченной задолженности, о кредитах, 
выданных ЦБ этой кредитной организации.

План счетов (список всех счетов и что они значат) можно посмотреть тут:

- [Документ ЦБ с планом счетами](http://www.cbr.ru/analytics/standart_acts/others/302-p.pdf)
- [Консультант + ](http://www.consultant.ru/document/cons_doc_LAW_174901/?frame=1#p71)
- [Google](https://www.google.ru/search?hl=ru&q=%D0%BF%D0%BB%D0%B0%D0%BD+%D1%81%D1%87%D0%B5%D1%82%D0%BE%D0%B2+%D0%B1%D0%B0%D0%BD%D0%BA%D0%B0&btnG=%D0%9F%D0%BE%D0%B8%D1%81%D0%BA+%D0%B2+Google&lr=&gws_rd=ssl)

## Структура

Папка на определенную дату (в зависимости от периода) содержит следующие файлы:

1. mmyyyy_B.DBF - балансы банков
2. mmyyyy_N.DBF - имена банков, которые есть в отчете в п. 1
3. mmyyyy_S.DBF - ненужный файл
4. mmyyyyB1.DBF - балансы банков
5. mmyyyyN1.DBF - имена банков, которые есть в отчете в п. 4
6. mmyyyyS1.DBF - ненужный файл
7. names.DBF - номера и названия счетов

Файлы, которые имеют "_", отличаются от других просто количеством предоставляемой информации. Если банк есть в одной файле, то его нет в другом.

Описание переменных можно взять тут: 

## Загрузка данных

Для загрузки данных формата `DBF` необходима функция `read.dbf()` пакет `foreign`.



```r
    setwd("~/Яндекс.Диск/banks")
    library(foreign)
    d_b <- read.dbf(file = adr, as.is = T)
    head(d_b)
```

```
##   REGN PLAN NUM_SC   ITOGO A_P         DT
## 1 1326 \x80  20309  655970   2 2015-04-01
## 2 1326 \x80  30122       2   2 2015-04-01
## 3 1326 \x80  30220 1929601   2 2015-04-01
## 4 1326 \x80  30221       0   1 2015-04-01
## 5 1326 \x80  30236 1512465   2 2015-04-01
## 6 1326 \x80  30413  286795   1 2015-04-01
```

```r
# adr - путь к файлу, текстовый тип, вида "./101-20140401/032015_B.DBF"
# параметр as.is = T указывает функции на то, чтобы она текстовые форматы 
# оставляла текстовыми, а не переделывала в факторные
```

Для получения адреса можно использовать функции `list.dirs` и `list.files`. 

1. `list.dirs(path = , recursive = )` - позволяет получить список все папок (директорий).
    - параметр `path` указывает, где надо искать папки;
    - если параметр `recursive` указан как `F`, то будут выведены, только папки, которые находят по указаному адресу в `path`, Если параметр указан как `T`, то функция будет искать папки и внутри уже найденных папок.

Пример:

```r
    setwd("~/Яндекс.Диск/banks")
    head(list.dirs(path = ".", recursive = F))
```

```
## [1] "./101-20040201" "./101-20040301" "./101-20040401" "./101-20040501"
## [5] "./101-20040601" "./101-20040701"
```

```r
# В данном случае результаты будут одинаковые для случая recursive = F и T, 
# так как папок (вложенных) больше нет
```
   
2. `list.files(path = , pattern = , recursive = , ignore.case = )` позволяет найти файлы по заданному адресу. 
    - `path` содержит путь, где надо искать файлы; 
    - в параметре `pattern` указывается шаблон искомых файлов. Например, можно указать "B.DBF$", чтобы он искал только файлы, которые заканчиваются на "B.DBF", а знак $ указывает на то, что это должен быть конец строки (более подробно о таких символах в разделе "Работа с текстом. Регулярные выражения"). 
    - параметр `recursive` указывает, надо ли искать в
имеющихся папках дальше (вглубь). 
    - `ignore.case = T` указывает, что надо игнорировать
регистр (большие и маленькие буквы).


```r
    setwd("~/Яндекс.Диск/banks")
    head(list.files(path = "." , pattern = ".DBF$", 
                    recursive = T, ignore.case = T))
```

```
## [1] "101-20040201/012004_B.DBF" "101-20040201/NAMES.DBF"   
## [3] "101-20040301/022004_B.DBF" "101-20040301/NAMES.DBF"   
## [5] "101-20040401/032004_B.DBF" "101-20040401/NAMES.DBF"
```

Данными функциями можно воспользоваться, чтобы получить список всех папок,
путем сортировки, можно найти "последнюю" папку (то есть папку на последнюю 
доступную дату). Затем можно получить список файлов, находящихся в папке. 

# Кластеризация

Загрузив данные на последнюю доступную дату необходимо провести 
кластеризацию банков. Для начала необходимо выбрать параметры, по которым 
будут сраниваться банки. Например: размер активов, доля депозитов ФЛ в активах,
отношение депозитов к кредитам.

Провести кластеризацию модифицрованным методом K-means. В рамках кластеризации 
определить не только принадлежность каждого банка к кластеру, но и 
определить количество кластеров.

## Метод K-means

## Модификация X-means

## Отрисовка

# Динамика доли государственных банков

# Приложение.

## Работа с текстом. Регулярные выражения.
