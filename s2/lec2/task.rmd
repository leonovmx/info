---
title: "Задача 1"
author: "LM"
date: "17 февраля 2015 г."
output: html_document
---
Задача на анализ данных
======================
Имеются данные по 332 датчикам, измеряющим уровень загрязнения в 332 точках США.
Данные по каждому датчику хранятся в отдельном **.csv** файле, название которого
является ID датчика. Например, данные датчика №1 хранятся в файле **"001.csv"**.

Данные можно скачать тут: https://yadi.sk/d/nPgfPD0WejLWP

Каждый файл содержит 3 переменные:

- **Date**: Дата наблюдения в формате YYYY-MM-DD
- **sulfate**: уровень содержания сульфатов в воздухе (микрограммы/м^3)
- **nitrate**: уровень содержания нитратов в воздухе (микрограммы/м^3)

В данных могут содержаться пропуски значений (NA) для любой переменной.

Необходимо распаковать файл **specdata.zip** в созданную папку **'specdata'**
Далее задать в качестве рабочей директории папку, содержащую  папку **'specdata'**
Затем написать три функции.

  1. **getmonitor** - получение данных с конкретного датчика.
  2. **complete** - получение сведений о количестве полных наблюдений для заданного
   списка датчиков.
  3. **corr** - получение вектора корреляций нитратов и сульфатов по всем датчикам
   для заданного порогового значения количества полных наблюдений.

Функция 2 может использовать функцию 1 и не может содержать оператор **complete.cases**
Функция 3 может использовать функцию 1 и 2

# Getmonitor()
```{r, results='hide'}
getmonitor <- function(id, directory, summarize = FALSE) {
    # Тело функции
}
```

#### Аргументы функции
- *'id'* - вектор (длина=1), обозначающий номер датчика. 
Пользователь может ввести целое число, число, число в виде символа.

- *'directory'* - символьная переменная длиной 1, обозначающая
место хранения таблиц данных 
  
- *'summarize'*  - логический индикатор. 
По умолчанию "Ложь" - печать не производится
Если "Правда" - производится печать сводной информации

#### Вывод функции 
Функция должна возвращать данные наблюдений конктретного датчика 
в выбранной директории в формате **data.frame**. При необходимости выводить
на экран сводные данные.

```{r, echo=FALSE}
getmonitor <- function(id, directory, summarize = FALSE) {
    setwd("~/Downloads/data_frame")
    id<-as.integer(id)
    if(id<10) {id<-paste('00',id,sep='')} else {
    if(id<100) {id<-paste('0',id,sep='')}}
    path<-paste(directory,'/',id,'.csv',sep='')
    d<-read.csv(path)
    if (summarize) {print(summary(d))}
    return(d)
}
```
Пример 1.
```{r}
data <- getmonitor("1", "specdata")
head(data)
```
Пример 2.
```{r}
data <- getmonitor(101.00, "specdata", TRUE)
head(data)
```

# Complete()

```{r}
complete <- function(directory, id = 1:332) {
    # тело функции   
}
```

#### Аргументы функции
- **'directory'** - символьная переменная длиной 1, обозначающая место хранения таблиц данных 
- **'id'** - целочисленный вектор, обозначающий ID используемых датчиков
  
Требуется найти количество полных наблюдений (без пропущенных, т.е. без NA)
в данных для контретногосписка датчиков

#### Вывод функции 
Функция должна возвращать данные в следующем виде (формат data.frame):
id nobs
1  117
2  1041
  
```{r, echo=FALSE}
complete <- function(directory, id = 1:332) {
    setwd("~/Downloads/data_frame")
    n<-length(id)
    otv<-matrix(0,nrow=n,ncol=2)
    b<-1
    for(i in id) {
        d<-getmonitor(i, "specdata")
        otv[b,]<-c(i,length(d[(!is.na(d[,'sulfate']))&(!is.na(d[,'nitrate'])),1]))
        b<-b+1
    }
  otv<-data.frame(otv)
  names(otv)<-c('id','nobs')
  return(otv)
}
```
  
Пример 1.
```{r, cache=TRUE}
complete("specdata", c(2, 4, 8, 10, 12))
```
Пример 2.
```{r, cache=TRUE}
complete("specdata", 30:25)
```
Пример 3.
```{r,cache=TRUE}
complete("specdata", 3)
```

# corr()
```{r}
    corr <- function(directory, threshold = 0) {
        # тело функции   
    }
```
#### Аргументы функции
- **'directory'** - символьная переменная длиной 1, обозначающая место хранения таблиц данных 
- **'threshold'** - числовой вектор длиной 1, обозначающий пороговое значение для требуемого количества полных наблюдений, необходимого для расчета корреляции между значениями нитратов и сульфатов. По умолчанию 0.

#### Вывод функции
Функция должна возвращать вектор корреляций значений нитратов и сульфатов для каждого датчика, у которого количество полных наблюдений больше или равно пороговому значению. 

```{r, echo=FALSE}
corr <- function(directory, threshold = 0) {
    corr<-c()
    for (id in 1:332) {
        d<-getmonitor(id,'specdata')
        n<-complete("specdata", id)
        if((n[1,2])>=threshold) {
            data<-d[complete.cases(d),]
            a<-cor(data[,'sulfate'],data[,'nitrate'])
            corr<-c(corr,a)
        }
    }
    return(corr) 
}
```

Пример 1.
```{r, cache=TRUE}
cr <- corr("specdata") 
summary(cr)
length(cr)
```

```{r, cache=TRUE}
cr <- corr("specdata", 5000)
summary(cr)
length(cr)
```

# Функции
-- test 
Formula

$$ D(x) = (x_i - x)^2 $$
